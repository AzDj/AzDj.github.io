<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>jumpserver 堡垒机安装 | AzDj</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">jumpserver 堡垒机安装</h1><a id="logo" href="/.">AzDj</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">jumpserver 堡垒机安装</h1><div class="post-meta">Oct 13, 2018</div><a class="disqus-comment-count" href="/2018/10/13/jumpserver(跳板机)安装/#vcomment"><span class="valine-comment-count" data-xid="/2018/10/13/jumpserver(跳板机)安装/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker安装方式"><span class="toc-number">1.</span> <span class="toc-text">docker安装方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ss翻墙"><span class="toc-number">1.1.</span> <span class="toc-text">ss翻墙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker运行"><span class="toc-number">1.2.</span> <span class="toc-text">docker运行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#访问"><span class="toc-number">1.2.1.</span> <span class="toc-text">访问</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#仓库地址"><span class="toc-number">1.3.</span> <span class="toc-text">仓库地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jumpserver-CentOS-一步步安装"><span class="toc-number">2.</span> <span class="toc-text">jumpserver CentOS 一步步安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#准备-Python3-和-Python-虚拟环境"><span class="toc-number">2.1.</span> <span class="toc-text">准备 Python3 和 Python 虚拟环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装依赖包"><span class="toc-number">2.1.1.</span> <span class="toc-text">安装依赖包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编译安装"><span class="toc-number">2.1.2.</span> <span class="toc-text">编译安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#建立-Python-虚拟环境"><span class="toc-number">2.1.3.</span> <span class="toc-text">建立 Python 虚拟环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自动载入-Python-虚拟环境配置"><span class="toc-number">2.1.4.</span> <span class="toc-text">自动载入 Python 虚拟环境配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Jumpserver"><span class="toc-number">2.2.</span> <span class="toc-text">安装 Jumpserver</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#下载或-Clone-项目"><span class="toc-number">2.2.1.</span> <span class="toc-text">下载或 Clone 项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装依赖-RPM-包"><span class="toc-number">2.2.2.</span> <span class="toc-text">安装依赖 RPM 包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-Python-库依赖"><span class="toc-number">2.2.3.</span> <span class="toc-text">安装 Python 库依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-Redis-Jumpserver-使用-Redis-做-cache-和-celery-broke"><span class="toc-number">2.2.4.</span> <span class="toc-text">安装 Redis, Jumpserver 使用 Redis 做 cache 和 celery broke</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-MySQL"><span class="toc-number">2.2.5.</span> <span class="toc-text">安装 MySQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建数据库-Jumpserver-并授权"><span class="toc-number">2.2.6.</span> <span class="toc-text">创建数据库 Jumpserver 并授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-Jumpserver-配置文件"><span class="toc-number">2.2.7.</span> <span class="toc-text">修改 Jumpserver 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#生成数据库表结构和初始化数据"><span class="toc-number">2.2.8.</span> <span class="toc-text">生成数据库表结构和初始化数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行-Jumpserver"><span class="toc-number">2.2.9.</span> <span class="toc-text">运行 Jumpserver</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-SSH-Server-和-WebSocket-Server-Coco"><span class="toc-number">2.3.</span> <span class="toc-text">安装 SSH Server 和 WebSocket Server: Coco</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#下载或-Clone-项目-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">下载或 Clone 项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装依赖"><span class="toc-number">2.3.2.</span> <span class="toc-text">安装依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改配置文件并运行"><span class="toc-number">2.3.3.</span> <span class="toc-text">修改配置文件并运行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Web-Terminal-前端-Luna"><span class="toc-number">2.4.</span> <span class="toc-text">安装 Web Terminal 前端: Luna</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#解压-Luna"><span class="toc-number">2.4.1.</span> <span class="toc-text">解压 Luna</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Windows-支持组件（如果不需要管理-windows-资产，可以直接跳过这一步）"><span class="toc-number">2.5.</span> <span class="toc-text">安装 Windows 支持组件（如果不需要管理 windows 资产，可以直接跳过这一步）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker安装-仅针对CentOS7，CentOS6安装Docker相对比较复杂"><span class="toc-number">2.5.1.</span> <span class="toc-text">Docker安装 (仅针对CentOS7，CentOS6安装Docker相对比较复杂)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#添加docker官方源"><span class="toc-number">2.5.2.</span> <span class="toc-text">添加docker官方源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-Guacamole"><span class="toc-number">2.5.3.</span> <span class="toc-text">启动 Guacamole</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置-Nginx-整合各组件"><span class="toc-number">2.6.</span> <span class="toc-text">配置 Nginx 整合各组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-Nginx-根据喜好选择安装方式和版本"><span class="toc-number">2.6.1.</span> <span class="toc-text">安装 Nginx 根据喜好选择安装方式和版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#准备配置文件"><span class="toc-number">2.6.2.</span> <span class="toc-text">准备配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行-Nginx"><span class="toc-number">2.7.</span> <span class="toc-text">运行 Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开始使用-Jumpserver"><span class="toc-number">2.8.</span> <span class="toc-text">开始使用 Jumpserver</span></a></li></ol></li></ol></div></div><div class="post-content"><p>jumpserver跳板机、堡垒机，是运维环节中最关键的一个节点。因为其能让运维减少背锅风险，拥有着操作可回溯，权限可管控，减少密码泄露等风险，所以简介就写到这里。<br><a id="more"></a></p>
<h2 id="docker安装方式"><a href="#docker安装方式" class="headerlink" title="docker安装方式"></a>docker安装方式</h2><p>安装详情见官网 <a href="https://docs.docker.com/install/" target="_blank" rel="noopener">https://docs.docker.com/install/</a></p>
<h3 id="ss翻墙"><a href="#ss翻墙" class="headerlink" title="ss翻墙"></a>ss翻墙</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install python-pip</span><br><span class="line"></span><br><span class="line">pip安装ss</span><br><span class="line">pip install shadowsocks</span><br><span class="line"></span><br><span class="line">ss命令执行</span><br><span class="line">sslocal -s 199.247.16.xxx -p 222 -b 127.0.0.1 -l 1080 -k ReXueYouXi&amp;&amp;666 -m rc4-md5 &amp;</span><br></pre></td></tr></table></figure>
<h3 id="docker运行"><a href="#docker运行" class="headerlink" title="docker运行"></a>docker运行</h3><p>快速启动</p>
<p>使用 root 命令行输入:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 -p 2222:2222 registry.jumpserver.org/public/jumpserver:1.0.0</span><br></pre></td></tr></table></figure>
<h4 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h4><p>浏览器访问: <a href="http://jumpserver_ip:8080" target="_blank" rel="noopener">http://jumpserver_ip:8080</a></p>
<p>SSH访问: ssh -p 2222 jumpserver_ip</p>
<p>XShell等工具请添加connection连接<br>额外环境变量</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DB_ENGINE = mysql</span><br><span class="line">DB_HOST = mysql_host</span><br><span class="line">DB_PORT = 3306</span><br><span class="line">DB_USER = xxx</span><br><span class="line">DB_PASSWORD = xxxx</span><br><span class="line">DB_NAME = jumpserver</span><br><span class="line">REDIS_HOST = &lt;redis-host&gt;</span><br><span class="line">REDIS_PORT = &lt;redis-port&gt;</span><br><span class="line">REDIS_PASSWORD = &lt;</span><br></pre></td></tr></table></figure>
<p>完整执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 -p 2222:2222 -e DB_ENGINE=mysql -e DB_HOST=192.168.1.1 -e DB_PORT=3306 -e DB_USER=root -e DB_PASSWORD=xxx -e DB_NAME=jumpserver  registry.jumpserver.org/public/jumpserver:1.0.0</span><br></pre></td></tr></table></figure>
<h3 id="仓库地址"><a href="#仓库地址" class="headerlink" title="仓库地址"></a>仓库地址</h3><p>github地址：<a href="https://github.com/jumpserver/Dockerfile" target="_blank" rel="noopener">https://github.com/jumpserver/Dockerfile</a></p>
<hr>
<h2 id="jumpserver-CentOS-一步步安装"><a href="#jumpserver-CentOS-一步步安装" class="headerlink" title="jumpserver CentOS 一步步安装"></a>jumpserver CentOS 一步步安装</h2><p>官方文档地址 <a href="http://docs.jumpserver.org/zh/docs/step_by_step.html" target="_blank" rel="noopener">http://docs.jumpserver.org/zh/docs/step_by_step.html</a></p>
<p>安装过程中遇到问题可参考 安装过程中常见的问题</p>
<p>测试推荐硬件</p>
<ul>
<li>CPU: 64位双核处理器</li>
<li>内存: 4G DDR3</li>
</ul>
<p>环境</p>
<ul>
<li>系统: CentOS 7</li>
<li>IP: 192.168.244.144</li>
<li>关闭 selinux 和防火墙</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 7</span></span><br><span class="line">$ setenforce 0  <span class="comment"># 临时关闭，重启后失效</span></span><br><span class="line">$ systemctl stop firewalld.service  <span class="comment"># 临时关闭，重启后失效</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改字符集，否则可能报 input/output error的问题，因为日志里打印了中文</span></span><br><span class="line">$ localedef -c -f UTF-8 -i zh_CN zh_CN.UTF-8</span><br><span class="line">$ <span class="built_in">export</span> LC_ALL=zh_CN.UTF-8</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'LANG="zh_CN.UTF-8"'</span> &gt; /etc/locale.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS6</span></span><br><span class="line">$ setenforce 0  <span class="comment"># 临时关闭，重启后失效</span></span><br><span class="line">$ service iptables stop  <span class="comment"># 临时关闭，重启后失效</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改字符集，否则可能报 input/output error的问题，因为日志里打印了中文</span></span><br><span class="line">$ localedef -c -f UTF-8 -i zh_CN zh_CN.UTF-8</span><br><span class="line">$ <span class="built_in">export</span> LC_ALL=zh_CN.UTF-8</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'LANG=zh_CN.UTF-8'</span> &gt; /etc/sysconfig/i18n</span><br></pre></td></tr></table></figure>
<h3 id="准备-Python3-和-Python-虚拟环境"><a href="#准备-Python3-和-Python-虚拟环境" class="headerlink" title="准备 Python3 和 Python 虚拟环境"></a>准备 Python3 和 Python 虚拟环境</h3><h4 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sqli拓展和git</span></span><br><span class="line">$ yum -y install wget sqlite-devel xz gcc automake zlib-devel openssl-devel epel-release git</span><br></pre></td></tr></table></figure>
<p>Yum 加速设置请参考 <a href="http://mirrors.163.com/.help/centos.html" target="_blank" rel="noopener">http://mirrors.163.com/.help/centos.html</a></p>
<h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://www.python.org/ftp/python/3.6.1/Python-3.6.1.tar.xz</span><br><span class="line">$ tar xvf Python-3.6.1.tar.xz  &amp;&amp; <span class="built_in">cd</span> Python-3.6.1</span><br><span class="line">$ ./configure &amp;&amp; make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里必须执行编译安装，否则在安装 Python 库依赖时会有麻烦...</span></span><br></pre></td></tr></table></figure>
<h4 id="建立-Python-虚拟环境"><a href="#建立-Python-虚拟环境" class="headerlink" title="建立 Python 虚拟环境"></a>建立 Python 虚拟环境</h4><p>因为 CentOS 6/7 自带的是 Python2，而 Yum 等工具依赖原来的 Python，为了不扰乱原来的环境我们来使用 Python 虚拟环境</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt</span><br><span class="line">$ python3 -m venv py3</span><br><span class="line">$ <span class="built_in">source</span> /opt/py3/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 看到下面的提示符代表成功，以后运行 Jumpserver 都要先运行以上 source 命令，以下所有命令均在该虚拟环境中运行</span></span><br><span class="line">(py3) [root@localhost py3]</span><br></pre></td></tr></table></figure>
<h4 id="自动载入-Python-虚拟环境配置"><a href="#自动载入-Python-虚拟环境配置" class="headerlink" title="自动载入 Python 虚拟环境配置"></a>自动载入 Python 虚拟环境配置</h4><p>此项仅为懒癌晚期的人员使用，防止运行 Jumpserver 时忘记载入 Python 虚拟环境导致程序无法运行。使用autoenv</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入指定目录后会自动切换为py3</span></span><br><span class="line">$ <span class="built_in">cd</span> /opt</span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">clone</span> git://github.com/kennethreitz/autoenv.git</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'source /opt/autoenv/activate.sh'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>
<h3 id="安装-Jumpserver"><a href="#安装-Jumpserver" class="headerlink" title="安装 Jumpserver"></a>安装 Jumpserver</h3><h4 id="下载或-Clone-项目"><a href="#下载或-Clone-项目" class="headerlink" title="下载或 Clone 项目"></a>下载或 Clone 项目</h4><p>项目提交较多 git clone 时较大，你可以选择去 Github 项目页面直接下载zip包。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/jumpserver/jumpserver.git &amp;&amp; <span class="built_in">cd</span> jumpserver &amp;&amp; git checkout master</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"source /opt/py3/bin/activate"</span> &gt; /opt/jumpserver/.env  <span class="comment"># 进入 jumpserver 目录时将自动载入 python 虚拟环境</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首次进入 jumpserver 文件夹会有提示，按 y 即可</span></span><br><span class="line"><span class="comment"># Are you sure you want to allow this? (y/N) y</span></span><br></pre></td></tr></table></figure>
<h4 id="安装依赖-RPM-包"><a href="#安装依赖-RPM-包" class="headerlink" title="安装依赖 RPM 包"></a>安装依赖 RPM 包</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/jumpserver/requirements</span><br><span class="line"><span class="comment"># 如果没有任何报错请继续</span></span><br><span class="line">$ yum -y install $(cat rpm_requirements.txt)</span><br></pre></td></tr></table></figure>
<h4 id="安装-Python-库依赖"><a href="#安装-Python-库依赖" class="headerlink" title="安装 Python 库依赖"></a>安装 Python 库依赖</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从指定站点下载文件中的pip插件</span></span><br><span class="line">$ pip install -r requirements.txt -i https://pypi.python.org/simple</span><br></pre></td></tr></table></figure>
<h4 id="安装-Redis-Jumpserver-使用-Redis-做-cache-和-celery-broke"><a href="#安装-Redis-Jumpserver-使用-Redis-做-cache-和-celery-broke" class="headerlink" title="安装 Redis, Jumpserver 使用 Redis 做 cache 和 celery broke"></a>安装 Redis, Jumpserver 使用 Redis 做 cache 和 celery broke</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install redis</span><br><span class="line">$ systemctl <span class="built_in">enable</span> redis</span><br><span class="line">$ systemctl start redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos6</span></span><br><span class="line">$ yum -y install redis</span><br><span class="line">$ chkconfig redis on</span><br><span class="line">$ service redis start</span><br></pre></td></tr></table></figure>
<h4 id="安装-MySQL"><a href="#安装-MySQL" class="headerlink" title="安装 MySQL"></a>安装 MySQL</h4><p>本教程使用 Mysql 作为数据库，如果不使用 Mysql 可以跳过相关 Mysql 安装和配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos7</span></span><br><span class="line">$ yum -y install mariadb mariadb-devel mariadb-server <span class="comment"># centos7下安装的是mariadb</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span> mariadb</span><br><span class="line">$ systemctl start mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos6 需要安装手动安装 mysql5.5 或以上的版本，自带的 mysql5.1 不支持，或者直接在其他现有 mysql 服务器上创建 jumpserver 数据库连接</span></span><br></pre></td></tr></table></figure>
<h4 id="创建数据库-Jumpserver-并授权"><a href="#创建数据库-Jumpserver-并授权" class="headerlink" title="创建数据库 Jumpserver 并授权"></a>创建数据库 Jumpserver 并授权</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mysql</span><br><span class="line">&gt; create database jumpserver default charset &apos;utf8&apos;;</span><br><span class="line">&gt; grant all on jumpserver.* to &apos;jumpserver&apos;@&apos;127.0.0.1&apos; identified by &apos;weakPassword&apos;;</span><br><span class="line">&gt; flush privileges;</span><br></pre></td></tr></table></figure>
<h4 id="修改-Jumpserver-配置文件"><a href="#修改-Jumpserver-配置文件" class="headerlink" title="修改 Jumpserver 配置文件"></a>修改 Jumpserver 配置文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/jumpserver</span><br><span class="line">$ cp config_example.py config.py</span><br><span class="line">$ vi config.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意对齐，不要直接复制本文档的内容，实际内容以文件为准，本文仅供参考</span></span><br></pre></td></tr></table></figure>
<p><code>注意: 配置文件是 Python 格式，不要用 TAB，而要用空格</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">    jumpserver.config</span><br><span class="line">    ~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">    Jumpserver project setting file</span><br><span class="line"></span><br><span class="line">    :copyright: (c) 2014-2017 by Jumpserver Team</span><br><span class="line">    :license: GPL v2, see LICENSE for more details.</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Config:</span><br><span class="line">    # Use it to encrypt or decrypt data</span><br><span class="line"></span><br><span class="line">    # Jumpserver 使用 SECRET_KEY 进行加密，请务必修改以下设置</span><br><span class="line">    # SECRET_KEY = os.environ.get(&apos;SECRET_KEY&apos;) or &apos;2vym+ky!997d5kkcc64mnz06y1mmui3lut#(^wd=%s_qj$1%x&apos;</span><br><span class="line">    SECRET_KEY = &apos;请随意输入随机字符串（推荐字符大于等于 50位）&apos;</span><br><span class="line"></span><br><span class="line">    # Django security setting, if your disable debug model, you should setting that</span><br><span class="line">    ALLOWED_HOSTS = [&apos;*&apos;]</span><br><span class="line"></span><br><span class="line">    # DEBUG 模式 True为开启 False为关闭，默认开启，生产环境推荐关闭</span><br><span class="line">    # 注意：如果设置了DEBUG = False，访问8080端口页面会显示不正常，需要搭建 nginx 代理才可以正常访问</span><br><span class="line">    DEBUG = os.environ.get(&quot;DEBUG&quot;) or True</span><br><span class="line"></span><br><span class="line">    # 日志级别，默认为DEBUG，可调整为INFO, WARNING, ERROR, CRITICAL，默认INFO</span><br><span class="line">    LOG_LEVEL = os.environ.get(&quot;LOG_LEVEL&quot;) or &apos;WARNING&apos;</span><br><span class="line">    LOG_DIR = os.path.join(BASE_DIR, &apos;logs&apos;)</span><br><span class="line"></span><br><span class="line">    # 使用的数据库配置，支持sqlite3, mysql, postgres等，默认使用sqlite3</span><br><span class="line">    # See https://docs.djangoproject.com/en/1.10/ref/settings/#databases</span><br><span class="line"></span><br><span class="line">    # 默认使用SQLite3，如果使用其他数据库请注释下面两行</span><br><span class="line">    # DB_ENGINE = &apos;sqlite3&apos;</span><br><span class="line">    # DB_NAME = os.path.join(BASE_DIR, &apos;data&apos;, &apos;db.sqlite3&apos;)</span><br><span class="line"></span><br><span class="line">    # 如果需要使用mysql或postgres，请取消下面的注释并输入正确的信息,本例使用mysql做演示(mariadb也是mysql)</span><br><span class="line">    DB_ENGINE = os.environ.get(&quot;DB_ENGINE&quot;) or &apos;mysql&apos;</span><br><span class="line">    DB_HOST = os.environ.get(&quot;DB_HOST&quot;) or &apos;127.0.0.1&apos;</span><br><span class="line">    DB_PORT = os.environ.get(&quot;DB_PORT&quot;) or 3306</span><br><span class="line">    DB_USER = os.environ.get(&quot;DB_USER&quot;) or &apos;jumpserver&apos;</span><br><span class="line">    DB_PASSWORD = os.environ.get(&quot;DB_PASSWORD&quot;) or &apos;weakPassword&apos;</span><br><span class="line">    DB_NAME = os.environ.get(&quot;DB_NAME&quot;) or &apos;jumpserver&apos;</span><br><span class="line"></span><br><span class="line">    # Django 监听的ip和端口，生产环境推荐把0.0.0.0修改成127.0.0.1，这里的意思是允许x.x.x.x访问，127.0.0.1表示仅允许自身访问</span><br><span class="line">    # ./manage.py runserver 127.0.0.1:8080</span><br><span class="line">    HTTP_BIND_HOST = &apos;0.0.0.0&apos;</span><br><span class="line">    HTTP_LISTEN_PORT = 8080</span><br><span class="line"></span><br><span class="line">    # Redis 相关设置</span><br><span class="line">    REDIS_HOST = os.environ.get(&quot;REDIS_HOST&quot;) or &apos;127.0.0.1&apos;</span><br><span class="line">    REDIS_PORT = os.environ.get(&quot;REDIS_PORT&quot;) or 6379</span><br><span class="line">    REDIS_PASSWORD = os.environ.get(&quot;REDIS_PASSWORD&quot;) or &apos;&apos;</span><br><span class="line">    REDIS_DB_CELERY = os.environ.get(&apos;REDIS_DB&apos;) or 3</span><br><span class="line">    REDIS_DB_CACHE = os.environ.get(&apos;REDIS_DB&apos;) or 4</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def __getattr__(self, item):</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DevelopmentConfig(Config):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestConfig(Config):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ProductionConfig(Config):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Default using Config settings, you can write if/else for different env</span><br><span class="line">config = DevelopmentConfig()</span><br></pre></td></tr></table></figure>
<h4 id="生成数据库表结构和初始化数据"><a href="#生成数据库表结构和初始化数据" class="headerlink" title="生成数据库表结构和初始化数据"></a>生成数据库表结构和初始化数据</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/jumpserver/utils</span><br><span class="line">$ bash make_migrations.sh</span><br></pre></td></tr></table></figure>
<h4 id="运行-Jumpserver"><a href="#运行-Jumpserver" class="headerlink" title="运行 Jumpserver"></a>运行 Jumpserver</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/jumpserver</span><br><span class="line">$ ./jms start all  <span class="comment"># 后台运行使用 -d 参数./jms start all -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新版本更新了运行脚本，使用方式./jms start|stop|status|restart all  后台运行请添加 -d 参数</span></span><br></pre></td></tr></table></figure>
<p>运行不报错，请浏览器访问 <a href="http://192.168.244.144:8080/" target="_blank" rel="noopener">http://192.168.244.144:8080/</a> 默认账号: admin 密码: admin 页面显示不正常先不用处理，继续往下操作，后面搭建 nginx 代理后即可正常访问，原因是因为 django 无法在非 debug 模式下加载静态资源</p>
<h3 id="安装-SSH-Server-和-WebSocket-Server-Coco"><a href="#安装-SSH-Server-和-WebSocket-Server-Coco" class="headerlink" title="安装 SSH Server 和 WebSocket Server: Coco"></a>安装 SSH Server 和 WebSocket Server: Coco</h3><h4 id="下载或-Clone-项目-1"><a href="#下载或-Clone-项目-1" class="headerlink" title="下载或 Clone 项目"></a>下载或 Clone 项目</h4><p>新开一个终端，别忘了 source /opt/py3/bin/activate</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt</span><br><span class="line">$ <span class="built_in">source</span> /opt/py3/bin/activate</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/jumpserver/coco.git &amp;&amp; <span class="built_in">cd</span> coco &amp;&amp; git checkout master</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"source /opt/py3/bin/activate"</span> &gt; /opt/coco/.env  <span class="comment"># 进入 coco 目录时将自动载入 python 虚拟环境</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首次进入 coco 文件夹会有提示，按 y 即可</span></span><br><span class="line"><span class="comment"># Are you sure you want to allow this? (y/N) y</span></span><br></pre></td></tr></table></figure>
<h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/coco/requirements</span><br><span class="line">$ yum -y  install $(cat rpm_requirements.txt)</span><br><span class="line">$ pip install -r requirements.txt -i https://pypi.python.org/simple</span><br></pre></td></tr></table></figure>
<h4 id="修改配置文件并运行"><a href="#修改配置文件并运行" class="headerlink" title="修改配置文件并运行"></a>修改配置文件并运行</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/coco</span><br><span class="line">$ cp conf_example.py conf.py  <span class="comment"># 如果 coco 与 jumpserver 分开部署，请手动修改 conf.py</span></span><br><span class="line">$ vi conf.py</span><br></pre></td></tr></table></figure>
<p><code>注意对齐，不要直接复制本文档的内容</code></p>
<p><code>注意: 配置文件是 Python 格式，不要用 TAB，而要用空格</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">BASE_DIR = os.path.dirname(__file__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Config:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Coco config file, coco also load config from server update setting below</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # 项目名称, 会用来向Jumpserver注册, 识别而已, 不能重复</span><br><span class="line">    # NAME = &quot;localhost&quot;</span><br><span class="line">    NAME = &quot;coco&quot;</span><br><span class="line"></span><br><span class="line">    # Jumpserver项目的url, api请求注册会使用, 如果Jumpserver没有运行在127.0.0.1:8080，请修改此处</span><br><span class="line">    # CORE_HOST = os.environ.get(&quot;CORE_HOST&quot;) or &apos;http://127.0.0.1:8080&apos;</span><br><span class="line">    CORE_HOST = &apos;http://127.0.0.1:8080&apos;</span><br><span class="line"></span><br><span class="line">    # 启动时绑定的ip, 默认 0.0.0.0</span><br><span class="line">    # BIND_HOST = &apos;0.0.0.0&apos;</span><br><span class="line"></span><br><span class="line">    # 监听的SSH端口号, 默认2222</span><br><span class="line">    # SSHD_PORT = 2222</span><br><span class="line"></span><br><span class="line">    # 监听的HTTP/WS端口号，默认5000</span><br><span class="line">    # HTTPD_PORT = 5000</span><br><span class="line"></span><br><span class="line">    # 项目使用的ACCESS KEY, 默认会注册,并保存到 ACCESS_KEY_STORE中,</span><br><span class="line">    # 如果有需求, 可以写到配置文件中, 格式 access_key_id:access_key_secret</span><br><span class="line">    # ACCESS_KEY = None</span><br><span class="line"></span><br><span class="line">    # ACCESS KEY 保存的地址, 默认注册后会保存到该文件中</span><br><span class="line">    # ACCESS_KEY_STORE = os.path.join(BASE_DIR, &apos;keys&apos;, &apos;.access_key&apos;)</span><br><span class="line"></span><br><span class="line">    # 加密密钥</span><br><span class="line">    # SECRET_KEY = None</span><br><span class="line"></span><br><span class="line">    # 设置日志级别 [&apos;DEBUG&apos;, &apos;INFO&apos;, &apos;WARN&apos;, &apos;ERROR&apos;, &apos;FATAL&apos;, &apos;CRITICAL&apos;]</span><br><span class="line">    # LOG_LEVEL = &apos;INFO&apos;</span><br><span class="line">    LOG_LEVEL = &apos;WARN&apos;</span><br><span class="line"></span><br><span class="line">    # 日志存放的目录</span><br><span class="line">    # LOG_DIR = os.path.join(BASE_DIR, &apos;logs&apos;)</span><br><span class="line"></span><br><span class="line">    # Session录像存放目录</span><br><span class="line">    # SESSION_DIR = os.path.join(BASE_DIR, &apos;sessions&apos;)</span><br><span class="line"></span><br><span class="line">    # 资产显示排序方式, [&apos;ip&apos;, &apos;hostname&apos;]</span><br><span class="line">    # ASSET_LIST_SORT_BY = &apos;ip&apos;</span><br><span class="line"></span><br><span class="line">    # 登录是否支持密码认证</span><br><span class="line">    # PASSWORD_AUTH = True</span><br><span class="line"></span><br><span class="line">    # 登录是否支持秘钥认证</span><br><span class="line">    # PUBLIC_KEY_AUTH = True</span><br><span class="line"></span><br><span class="line">    # SSH白名单</span><br><span class="line">    # ALLOW_SSH_USER = &apos;all&apos;  # [&apos;test&apos;, &apos;test2&apos;]</span><br><span class="line"></span><br><span class="line">    # SSH黑名单, 如果用户同时在白名单和黑名单，黑名单优先生效</span><br><span class="line">    # BLOCK_SSH_USER = []</span><br><span class="line"></span><br><span class="line">    # 和Jumpserver 保持心跳时间间隔</span><br><span class="line">    # HEARTBEAT_INTERVAL = 5</span><br><span class="line"></span><br><span class="line">    # Admin的名字，出问题会提示给用户</span><br><span class="line">    # ADMINS = &apos;&apos;</span><br><span class="line">    COMMAND_STORAGE = &#123;</span><br><span class="line">        &quot;TYPE&quot;: &quot;server&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    REPLAY_STORAGE = &#123;</span><br><span class="line">        &quot;TYPE&quot;: &quot;server&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # SSH连接超时时间 (default 15 seconds)</span><br><span class="line">    # SSH_TIMEOUT = 15</span><br><span class="line"></span><br><span class="line">    # 语言 = en</span><br><span class="line">    LANGUAGE_CODE = &apos;zh&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">config = Config()</span><br></pre></td></tr></table></figure>
<ul>
<li>启动</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./cocod start  <span class="comment"># 后台运行使用 -d 参数./cocod start -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新版本更新了运行脚本，使用方式./cocod start|stop|status|restart  后台运行请添加 -d 参数</span></span><br><span class="line"></span><br><span class="line">启动成功后去Jumpserver 会话管理-终端管理(http://192.168.244.144:8080/terminal/terminal/）接受coco的注册</span><br></pre></td></tr></table></figure>
<h3 id="安装-Web-Terminal-前端-Luna"><a href="#安装-Web-Terminal-前端-Luna" class="headerlink" title="安装 Web Terminal 前端: Luna"></a>安装 Web Terminal 前端: Luna</h3><p>Luna 已改为纯前端，需要 Nginx 来运行访问</p>
<p>访问<a href="https://github.com/jumpserver/luna/releases" target="_blank" rel="noopener">https://github.com/jumpserver/luna/releases</a>下载对应版本的 release 包，直接解压，不需要编译</p>
<h4 id="解压-Luna"><a href="#解压-Luna" class="headerlink" title="解压 Luna"></a>解压 Luna</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt</span><br><span class="line">$ wget https://github.com/jumpserver/luna/releases/download/1.4.1/luna.tar.gz</span><br><span class="line">$ tar xvf luna.tar.gz</span><br><span class="line">$ chown -R root:root luna</span><br></pre></td></tr></table></figure>
<h3 id="安装-Windows-支持组件（如果不需要管理-windows-资产，可以直接跳过这一步）"><a href="#安装-Windows-支持组件（如果不需要管理-windows-资产，可以直接跳过这一步）" class="headerlink" title="安装 Windows 支持组件（如果不需要管理 windows 资产，可以直接跳过这一步）"></a>安装 Windows 支持组件（如果不需要管理 windows 资产，可以直接跳过这一步）</h3><p>因为手动安装 guacamole 组件比较复杂，这里提供打包好的 docker 使用, 启动 guacamole</p>
<h4 id="Docker安装-仅针对CentOS7，CentOS6安装Docker相对比较复杂"><a href="#Docker安装-仅针对CentOS7，CentOS6安装Docker相对比较复杂" class="headerlink" title="Docker安装 (仅针对CentOS7，CentOS6安装Docker相对比较复杂)"></a>Docker安装 (仅针对CentOS7，CentOS6安装Docker相对比较复杂)</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum remove docker-latest-logrotate docker-logrotate docker-selinux dockdocker-engine</span><br><span class="line">$ yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>
<h4 id="添加docker官方源"><a href="#添加docker官方源" class="headerlink" title="添加docker官方源"></a>添加docker官方源</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">$ yum makecache fast</span><br><span class="line">$ yum install docker-ce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 国内部分用户可能无法连接docker官网提供的源，这里提供阿里云的镜像节点供测试使用</span></span><br><span class="line">$ yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">$ rpm --import http://mirrors.aliyun.com/docker-ce/linux/centos/gpg</span><br><span class="line">$ yum makecache fast</span><br><span class="line">$ yum -y install docker-ce</span><br><span class="line"></span><br><span class="line">$ systemctl start docker</span><br><span class="line">$ systemctl status docker</span><br></pre></td></tr></table></figure>
<h4 id="启动-Guacamole"><a href="#启动-Guacamole" class="headerlink" title="启动 Guacamole"></a>启动 Guacamole</h4><p>这里所需要注意的是 guacamole 暴露出来的端口是 8081，若与主机上其他端口冲突请自定义</p>
<p><code>注意：这里需要修改下 http://&lt;填写jumpserver的url地址&gt; 例: http://192.168.244.144, 否则会出错, 带宽有限, 下载时间可能有点长，可以喝杯咖啡，撩撩对面的妹子</code></p>
<p><code>不能使用 127.0.0.1 ，可以更换 registry.jumpserver.org/public/guacamole:latest</code></p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="keyword">run</span><span class="bash"> --name jms_guacamole -d \</span></span><br><span class="line"><span class="bash">  -p 8081:8080 -v /opt/guacamole/key:/config/guacamole/key \</span></span><br><span class="line"><span class="bash">  -e JUMPSERVER_KEY_DIR=/config/guacamole/key \</span></span><br><span class="line"><span class="bash">  -e JUMPSERVER_SERVER=http://&lt;填写jumpserver的url地址&gt; \</span></span><br><span class="line"><span class="bash">  jumpserver/guacamole:latest</span></span><br></pre></td></tr></table></figure>
<p>启动成功后去Jumpserver 会话管理-终端管理<a href="http://192.168.244.144:8080/terminal/terminal/" target="_blank" rel="noopener">http://192.168.244.144:8080/terminal/terminal/</a>接受[Gua]开头的一个注册</p>
<h3 id="配置-Nginx-整合各组件"><a href="#配置-Nginx-整合各组件" class="headerlink" title="配置 Nginx 整合各组件"></a>配置 Nginx 整合各组件</h3><h4 id="安装-Nginx-根据喜好选择安装方式和版本"><a href="#安装-Nginx-根据喜好选择安装方式和版本" class="headerlink" title="安装 Nginx 根据喜好选择安装方式和版本"></a>安装 Nginx 根据喜好选择安装方式和版本</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install nginx</span><br></pre></td></tr></table></figure>
<h4 id="准备配置文件"><a href="#准备配置文件" class="headerlink" title="准备配置文件"></a>准备配置文件</h4><p> 修改 /etc/nginx/nginx.conf</p>
<p>内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/nginx/nginx.conf</span><br><span class="line"># CentOS 6 需要修改文件 /etc/nginx/cond.f/default.conf</span><br><span class="line"></span><br><span class="line">... 省略</span><br><span class="line"># 把默认server配置块改成这样，原有的内容请保持不动</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;  # 代理端口，以后将通过此端口进行访问，不再通过8080端口</span><br><span class="line"></span><br><span class="line">    client_max_body_size 100m;  # 录像上传大小限制</span><br><span class="line"></span><br><span class="line">    location /luna/ &#123;</span><br><span class="line">        try_files $uri / /index.html;</span><br><span class="line">        alias /opt/luna/;  # luna 路径，如果修改安装目录，此处需要修改</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /media/ &#123;</span><br><span class="line">        add_header Content-Encoding gzip;</span><br><span class="line">        root /opt/jumpserver/data/;  # 录像位置，如果修改安装目录，此处需要修改</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /static/ &#123;</span><br><span class="line">        root /opt/jumpserver/data/;  # 静态资源，如果修改安装目录，此处需要修改</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /socket.io/ &#123;</span><br><span class="line">        proxy_pass       http://localhost:5000/socket.io/;  # 如果coco安装在别的服务器，请填写它的ip</span><br><span class="line">        proxy_buffering off;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        access_log off;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /guacamole/ &#123;</span><br><span class="line">        proxy_pass       http://localhost:8081/;  # 如果guacamole安装在别的服务器，请填写它的ip</span><br><span class="line">        proxy_buffering off;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection $http_connection;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        access_log off;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:8080;  # 如果jumpserver安装在别的服务器，请填写它的ip</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">... 省略</span><br></pre></td></tr></table></figure>
<h3 id="运行-Nginx"><a href="#运行-Nginx" class="headerlink" title="运行 Nginx"></a>运行 Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nginx -t   <span class="comment"># 确保配置没有问题, 有问题请先解决</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 7</span></span><br><span class="line">$ systemctl start nginx</span><br><span class="line">$ systemctl <span class="built_in">enable</span> nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 6</span></span><br><span class="line">$ service nginx start</span><br><span class="line">$ chkconfig nginx on</span><br></pre></td></tr></table></figure>
<h3 id="开始使用-Jumpserver"><a href="#开始使用-Jumpserver" class="headerlink" title="开始使用 Jumpserver"></a>开始使用 Jumpserver</h3><p>检查应用是否已经正常运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/jumpserver</span><br><span class="line">$ ./jms status  <span class="comment"># 确定jumpserver已经运行，如果没有运行请重新启动jumpserver</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /opt/coco</span><br><span class="line">$ ./cocod status  <span class="comment"># 确定jumpserver已经运行，如果没有运行请重新启动coco</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果安装了 Guacamole</span></span><br><span class="line">$ docker ps  <span class="comment"># 检查容器是否已经正常运行，如果没有运行请重新启动Guacamole</span></span><br></pre></td></tr></table></figure>
<p>服务全部启动后，访问 <a href="http://192.168.244.144" target="_blank" rel="noopener">http://192.168.244.144</a>，访问nginx代理的端口，不要再通过8080端口访问</p>
<p>默认账号: admin 密码: admin</p>
<p>如果部署过程中没有接受应用的注册，需要到Jumpserver 会话管理-终端管理 接受 Coco Guacamole 等应用的注册。</p>
<p>测试连接</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">如果登录客户端是 macOS 或 Linux ，登录语法如下</span><br><span class="line">$ ssh -p2222 admin@192.168.244.144</span><br><span class="line">$ sftp -P2222 admin@192.168.244.144</span><br><span class="line">密码: admin</span><br><span class="line"></span><br><span class="line">如果登录客户端是 Windows ，Xshell Terminal 登录语法如下</span><br><span class="line">$ ssh admin@192.168.244.144 2222</span><br><span class="line">$ sftp admin@192.168.244.144 2222</span><br><span class="line">密码: admin</span><br><span class="line">如果能登陆代表部署成功</span><br><span class="line"></span><br><span class="line"><span class="comment"># sftp默认上传的位置在资产的 /tmp 目录下</span></span><br><span class="line"><span class="comment"># windows拖拽上传的位置在资产的 Guacamole RDP上的 G 目录下</span></span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/安装/">安装</a><a href="/tags/jumpserver/">jumpserver</a><a href="/tags/跳板机/">跳板机</a></div><div class="post-nav"><a class="pre" href="/2018/10/13/HelloEveryone/">HelloEveryone</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'true' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'Qq3TXn4kkYB1Y5amjdYD5pQM-gzGzoHsz',
  appKey:'lcphlalpyrDQNucYsK1wLn6D',
  placeholder:'',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://azdj.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/安装/" style="font-size: 15px;">安装</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/ITSM/" style="font-size: 15px;">ITSM</a> <a href="/tags/IT服务管理/" style="font-size: 15px;">IT服务管理</a> <a href="/tags/jenkins/" style="font-size: 15px;">jenkins</a> <a href="/tags/ansible/" style="font-size: 15px;">ansible</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/jumpserver/" style="font-size: 15px;">jumpserver</a> <a href="/tags/跳板机/" style="font-size: 15px;">跳板机</a> <a href="/tags/zabbix/" style="font-size: 15px;">zabbix</a> <a href="/tags/java/" style="font-size: 15px;">java</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/06/基于docker部署zabbix/">基于docker部署zabbix</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/06/docker-批量操作/">docker 批量操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/06/ansible安装jenkins/">ansible安装jenkins</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/22/ITSM/">ITSM</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/15/安装java/">安装java</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/13/HelloEveryone/">HelloEveryone</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/13/jumpserver(跳板机)安装/">jumpserver 堡垒机安装</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/welliamcao/OpsManage" title="自动化运维平台" target="_blank">自动化运维平台</a><ul></ul><a href="https://github.com/kurolz/Books" title="运维之道" target="_blank">运维之道</a><ul></ul><a href="https://www.haomwei.com/technology/maupassant-hexo.html" title="大道至简-屠城hexo主题" target="_blank">大道至简-屠城hexo主题</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">AzDj.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>