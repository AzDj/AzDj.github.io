<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>申请免费证书 | AzDj</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">申请免费证书</h1><a id="logo" href="/.">AzDj</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">申请免费证书</h1><div class="post-meta">Jan 5, 2019</div><a class="disqus-comment-count" href="/2019/申请免费证书.html#vcomment"><span class="valine-comment-count" data-xid="/2019/申请免费证书.html"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#手动签发通配符证书"><span class="toc-number">1.</span> <span class="toc-text">手动签发通配符证书</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Let’s-Encrypt"><span class="toc-number">1.1.</span> <span class="toc-text">Let’s Encrypt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通配符证书"><span class="toc-number">1.2.</span> <span class="toc-text">通配符证书</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#下载"><span class="toc-number">1.2.1.</span> <span class="toc-text">下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#升级"><span class="toc-number">1.2.2.</span> <span class="toc-text">升级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#签发"><span class="toc-number">1.2.3.</span> <span class="toc-text">签发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#命令行输出："><span class="toc-number">1.2.3.1.</span> <span class="toc-text">命令行输出：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#上传"><span class="toc-number">1.3.</span> <span class="toc-text">上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#证书兼容"><span class="toc-number">1.4.</span> <span class="toc-text">证书兼容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检验"><span class="toc-number">1.5.</span> <span class="toc-text">检验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动续签证"><span class="toc-number">2.</span> <span class="toc-text">自动续签证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#自动申请通配符证书"><span class="toc-number">2.0.1.</span> <span class="toc-text">自动申请通配符证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#续期证书"><span class="toc-number">2.0.2.</span> <span class="toc-text">续期证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#加入-crontab"><span class="toc-number">2.0.3.</span> <span class="toc-text">加入 crontab</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-number">3.</span> <span class="toc-text">参考文献</span></a></li></ol></div></div><div class="post-content"><p>自签发Let’s Encrypt通配符证书，外加自动续签笔记</p>
<a id="more"></a>
<h2 id="手动签发通配符证书"><a href="#手动签发通配符证书" class="headerlink" title="手动签发通配符证书"></a>手动签发通配符证书</h2><h3 id="Let’s-Encrypt"><a href="#Let’s-Encrypt" class="headerlink" title="Let’s Encrypt"></a>Let’s Encrypt</h3><p>部署 HTTPS 网站的时候需要证书，证书由 CA 机构签发，大部分传统 CA 机构签发证书是需要收费的，这不利于推动 HTTPS 协议的使用。[1]</p>
<p>而<a href="https://letsencrypt.org/" target="_blank" rel="noopener">Let’s Encrypt</a> 同样也是 CA 机构，但这个 CA 机构是免费的,也就是说签发证书不需要任何费用。</p>
<p>Let’s Encrypt 由于是非盈利性的组织，需要控制开支，他们搞了一个非常有创意的事情，设计了一个 ACME 协议，目前该协议的版本是v2</p>
<h3 id="通配符证书"><a href="#通配符证书" class="headerlink" title="通配符证书"></a>通配符证书</h3><p>Let’Encrypt在2018年2月就推出了通配符证书的签发,但签发的证书有效时间只有90天。</p>
<p>原因是他们根据Firefox 用户活动监测，29％的TLS交易都是使用九十天的有效证书。这比其他任何CA机构证书的都要多。从加密的角度来看，这种短证书生命周期有两个主要优点：</p>
<ol>
<li>短证书生命周期会限制密钥的泄露和错误签发。即便私钥失窃和错误签发的证书也只是在较短的时间内有效。</li>
<li>鼓励自动化，这对于易用性来说绝对必不可少。如果要将整个Web移动到HTTPS，就无法继续期望系统管理员手动处理续订。一旦发布和更新自动化，较长的有效时长比不较短的有效时长更方便。</li>
</ol>
<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>最好下载到需要申请通配符证书的web服务器上，letsencrypt执行会检测是否有web运行环境。没有会报错！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  git <span class="built_in">clone</span>  https://github.com/letsencrypt/letsencrypt</span><br></pre></td></tr></table></figure>
<h4 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h4><p>为了实现通配符证书，Let’s Encrypt 对 ACME 协议的实现进行了升级，只有 v2 协议才能支持通配符证书。由于是升级到了V2+版本，所以执行依赖升级</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> letsencrypt/</span><br><span class="line">查看版本的时候会自动更新到最新</span><br><span class="line">$ ./certbot-auto -V</span><br><span class="line">Bootstrapping dependencies <span class="keyword">for</span> RedHat-based OSes... (you can skip this with --no-bootstrap)</span><br><span class="line">yum is /usr/bin/yum</span><br><span class="line">.....</span><br></pre></td></tr></table></figure>
<p>在了申请签发之前有几个注意点：</p>
<p>1）客户在申请 Let’s Encrypt 证书的时候，需要校验域名的所有权，证明操作者有权利为该域名申请证书，目前支持三种验证方式：</p>
<ul>
<li>dns-01：给域名添加一个 DNS TXT 记录。</li>
<li>http-01：在域名对应的 Web 服务器下放置一个 HTTP well-known URL 资源文件。</li>
<li>tls-sni-01：在域名对应的 Web 服务器下放置一个 HTTPS well-known URL 资源文件。</li>
</ul>
<p>而申请通配符证书，只能使用 dns-01 的方式，即对DNS进行校验</p>
<p>2）ACME v2 和 v1 协议是互相不兼容的，为了使用 v2 版本，客户端需要创建另外一个账户（代表客户端操作者），以 Certbot 客户端为例，大家可以查看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tree /etc/letsencrypt/accounts </span><br><span class="line">.</span><br><span class="line">├── acme-staging.api.letsencrypt.org</span><br><span class="line">├── acme-v01.api.letsencrypt.org</span><br><span class="line">└── acme-v02.api.letsencrypt.org</span><br></pre></td></tr></table></figure>
<h4 id="签发"><a href="#签发" class="headerlink" title="签发"></a>签发</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./certbot-auto certonly \</span><br><span class="line">-d *.wms.iyali.com \</span><br><span class="line">--manual --preferred-challenges dns \</span><br><span class="line">--server https://acme-v02.api.letsencrypt.org/directory</span><br></pre></td></tr></table></figure>
<p>certonly，表示安装模式，Certbot 有安装模式和验证模式两种类型的插件。</p>
<p>–manual  表示手动安装插件，Certbot 有很多插件，不同的插件都可以申请证书，用户可以根据需要自行选择</p>
<p>-d 为那些主机申请证书，如果是通配符，输入 *.newyingyong.cn（可以替换为你自己的域名）</p>
<p>–preferred-challenges dns，使用 DNS 方式校验域名所有权</p>
<p>–server，Let’s Encrypt ACME v2 版本使用的服务器不同于 v1 版本，需要显示指定</p>
<h5 id="命令行输出："><a href="#命令行输出：" class="headerlink" title="命令行输出："></a>命令行输出：</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">ps:只要有任意一个流程按c都会取消签发</span><br><span class="line"></span><br><span class="line">Saving debug log to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Enter email address (used for urgent renewal and security notices) (Enter 'c' to</span><br><span class="line">cancel):</span><br><span class="line">输入需要申请的用户Email,按c是取消整个流程</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Please read the Terms of Service at</span><br><span class="line">https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must</span><br><span class="line">agree in order to register with the ACME server at</span><br><span class="line">https://acme-v02.api.letsencrypt.org/directory</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">(A)gree/(C)ancel:</span><br><span class="line">是否同意这个域名会经过letsencrypt的ACME服务器上注册</span><br><span class="line"></span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Obtaining a new certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">dns-01 challenge for newyingyong.cn</span><br><span class="line">使用插件获取新的证书，将以dns-01的方式对wns.iyali.com进行验证</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">NOTE: The IP of this machine will be publicly logged as having requested this</span><br><span class="line">certificate. If you're running certbot in manual mode on a machine that is not</span><br><span class="line">your server, please ensure you're okay with that.</span><br><span class="line">注意事项：如果不是在web服务器上执行，请确保有可用的web程序。</span><br><span class="line">Are you OK with your IP being logged?</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">(Y)es/(N)o: y</span><br><span class="line">是否确认将此ip公开记录于请求此域名证书。</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Please deploy a DNS TXT record under the name</span><br><span class="line">_acme-challenge.wms.iyali.com with the following value:</span><br><span class="line"></span><br><span class="line">WvNTQhajK_vl61hZ4au7VcXlgvU_EYu9zi8_1nFiNF4</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line">在iyali.com域名解析下做DNS TXT记录。</span><br><span class="line">并把对应的_acme-challenge.wms.iyali.com对应到WvNTQhajK_vl61hZ4au7VcXlgvU_EYu9zi8_1nFiNF4</span><br><span class="line">完成后按回车就能完成签发证书</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Press Enter to Continue</span><br><span class="line">Waiting for verification...</span><br><span class="line">Cleaning up challenges</span><br></pre></td></tr></table></figure>
<p>需要将DNS解析的TXT纪录完成才会进行签发，这个是对个人是否拥有该域名进行验证的一个过程</p>
<p>签发之后会在提示证书存放位置。如果没有保存证书存放位置，可以输入certificates查看签发的证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ./certbot-auto certificates</span><br><span class="line">Saving debug <span class="built_in">log</span> to /var/<span class="built_in">log</span>/letsencrypt/letsencrypt.log</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Found the following certs:</span><br><span class="line">  Certificate Name: wms.iyali.com</span><br><span class="line">    Domains: *.wms.iyali.com</span><br><span class="line">    Expiry Date: 2019-04-03 08:53:40+00:00 (VALID: 89 days)</span><br><span class="line">    Certificate Path: /etc/letsencrypt/live/wms.iyali.com/fullchain.pem</span><br><span class="line">    Private Key Path: /etc/letsencrypt/live/wms.iyali.com/privkey.pem</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></pre></td></tr></table></figure>
<h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><p>生成的证书有4个</p>
<p>cert.pem         chain.pem        fullchain.pem    privkey.pem</p>
<p>查看README后，建议使用的公钥证书是fullchain.pem。而chain.pem和cert.pem是在极端环境才会进行使用。我们这里因为是上传到阿里云均衡负载，使用fullchain.pem就可以了，chain.pem和cert.pem也也可以使用。</p>
<p>将 /etc/letsencrypt/live/wms.iyali.com/fullchain.pem内容复制到阿里云公钥处</p>
<h3 id="证书兼容"><a href="#证书兼容" class="headerlink" title="证书兼容"></a>证书兼容</h3><p>由于阿里云在2018年底修改了UI和后台，上传证书私钥需要以rsa加密后形式上传</p>
<p>这里需要手动转格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -<span class="keyword">in</span> privkey.pem -out privkey.rsa.pem</span><br></pre></td></tr></table></figure>
<h3 id="检验"><a href="#检验" class="headerlink" title="检验"></a>检验</h3><p>火狐浏览器验证</p>
<p>把证书放上去后，访问https域名显示验证者为Let’s Encrypt</p>
<p><img src="../../../img/签发.png" alt="签发验证"></p>
<h2 id="自动续签证"><a href="#自动续签证" class="headerlink" title="自动续签证"></a>自动续签证</h2><p>以下就是虞大胆的叽叽喳喳大大的github，自动定期签证</p>
<p><a href="https://github.com/ywdblog/certbot-letencrypt-wildcardcertificates-alydns-au" target="_blank" rel="noopener">github链接</a>[3]</p>
<p>使用 certbot 工具，为不能自动给 letencrypt 通配符证书自动续期（renew）而烦恼吗？这个工具能够帮忙！</p>
<p>不管是申请还是续期，只要是通配符证书，只能采用 dns-01 的方式校验申请者的域名，也就是说 certbot 操作者必须手动添加 DNS TXT 记录。</p>
<p>如果你编写一个 Cron (比如 1 1 <em>/1 </em> * root certbot-auto renew)，自动 renew 通配符证书，此时 Cron 无法自动添加 TXT 记录，这样 renew 操作就会失败，如何解决？</p>
<p>certbot 提供了一个 hook，可以编写一个 Shell 脚本，让脚本调用 DNS 服务商的 API 接口，动态添加 TXT 记录，这样就无需人工干预了。</p>
<p>在 certbot 官方提供的插件和 hook 例子中，都没有针对国内 DNS 服务器的样例，所以我编写了这样一个工具，目前支持阿里云 DNS 和腾讯云 DNS。</p>
<h4 id="自动申请通配符证书"><a href="#自动申请通配符证书" class="headerlink" title="自动申请通配符证书"></a>自动申请通配符证书</h4><p>1：下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/ywdblog/certbot-letencrypt-wildcardcertificates-alydns-au</span><br><span class="line"></span><br><span class="line">$ cd certbot-letencrypt-wildcardcertificates-alydns-au</span><br><span class="line"></span><br><span class="line">$ chmod 0777 au.sh autxy.sh python-version/au.sh</span><br></pre></td></tr></table></figure>
<p>2：配置</p>
<p>目前该工具支持三种运行环境：</p>
<ul>
<li>au.sh：操作阿里云 DNS hook shell（PHP 环境）。</li>
<li>autxy.sh：操作腾讯云 DNS hook shell（PHP 环境）。</li>
<li>python-version/au.py：操作阿里云 DNS hook shell（兼容<strong>Python 2/3</strong>）,感谢 @Duke-Wu 的 PR。</li>
</ul>
<p>这三种运行环境什么意思呢？就是可根据自己服务器环境和域名服务商选择任意一个 hook shell（操作的时候任选其一即可）。</p>
<p>DNS API 密钥：</p>
<ul>
<li>alydns.php，修改 accessKeyId、accessSecrec 变量，阿里云 <a href="https://help.aliyun.com/knowledge_detail/38738.html" target="_blank" rel="noopener">API key 和 Secrec 官方申请文档</a>。</li>
<li>txydns.php，修改 txyaccessKeyId、txyaccessSecrec 变量，腾讯云 <a href="https://console.cloud.tencent.com/cam/capi" target="_blank" rel="noopener">API 密钥官方申请文档</a>。</li>
<li>python-version/alydns.py，修改 ACCESS_KEY_ID、ACCESS_KEY_SECRET，阿里云 <a href="https://help.aliyun.com/knowledge_detail/38738.html" target="_blank" rel="noopener">API key 和 Secrec 官方申请文档</a>。</li>
</ul>
<p>这个 API 密钥什么意思呢？由于需要通过 API 操作阿里云 DNS 或腾讯云 DNS 的记录，所以需要去域名服务商哪儿获取 API 密钥。</p>
<p>3：申请证书</p>
<p><strong>特别说明：</strong> –manual-auth-hook 指定的 hook 文件三个任选其一（au.sh、autxy.sh、python-version/au.sh），其他操作完全相同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 测试是否有错误</span><br><span class="line">$ ./certbot-auto certonly  -d *.example.com --manual --preferred-challenges dns  --manual-auth-hook /脚本目录/au.sh（autxy.sh 或 python-version/au.sh，下面统一以 au.sh 介绍）  --dry-run  </span><br><span class="line"></span><br><span class="line"># 实际申请</span><br><span class="line">$ ./certbot-auto certonly  -d *.example.com --manual --preferred-challenges dns  --manual-auth-hook /脚本目录/au.sh</span><br></pre></td></tr></table></figure>
<p>如果你想为多个域名申请通配符证书（合并在一张证书中，也叫做 <strong>SAN 通配符证书</strong>），直接输入多个 -d 参数即可，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./certbot-auto certonly  -d *.example.com -d *.example.org  --manual --preferred-challenges dns  --manual-auth-hook /脚本目录/au.sh  --dry-run</span><br></pre></td></tr></table></figure>
<h4 id="续期证书"><a href="#续期证书" class="headerlink" title="续期证书"></a>续期证书</h4><p>1：对机器上所有证书 renew</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./certbot-auto renew  --manual --preferred-challenges dns  --manual-auth-hook /脚本目录/au.sh</span><br></pre></td></tr></table></figure>
<p>2：对某一张证书进行续期</p>
<p>先看看机器上有多少证书：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./certbot-auto certificates</span><br></pre></td></tr></table></figure>
<p>可以看到很多证书，如图：</p>
<p><a href="https://camo.githubusercontent.com/e336077865c3d96cffec59340c0275ac0eb4a31b/68747470733a2f2f6e6f7465732e6e657779696e67796f6e672e636e2f7374617469632f696d6167652f323031382f323031382d30372d31372d63657274626f742d6d616e61676572636572742e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/e336077865c3d96cffec59340c0275ac0eb4a31b/68747470733a2f2f6e6f7465732e6e657779696e67796f6e672e636e2f7374617469632f696d6167652f323031382f323031382d30372d31372d63657274626f742d6d616e61676572636572742e706e67" alt="管理证书"></a></p>
<p>记住证书名，比如 simplehttps.com，然后运行下列命令 renew：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./certbot-auto renew --cert-name simplehttps.com  --manual-auth-hook /脚本目录/au.sh</span><br></pre></td></tr></table></figure>
<h4 id="加入-crontab"><a href="#加入-crontab" class="headerlink" title="加入 crontab"></a>加入 crontab</h4><p>编辑文件 /etc/crontab :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 1 */1 * * root certbot-auto renew --manual --preferred-challenges dns  --manual-auth-hook /脚本目录/au.sh</span><br></pre></td></tr></table></figure>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[1]虞大胆的叽叽喳喳，<em>Let’s Encrypt 终于支持通配符证书了</em> [DB/OL]，2018  <a href="https://www.jianshu.com/p/c5c9d071e395" target="_blank" rel="noopener">引用连接</a></p>
<p>[2]十三六，<em>阿里云负载均衡使用letsencrypt证书</em> [DB/OL],2018 <a href="https://www.jianshu.com/p/0c6ddba6ece8" target="_blank" rel="noopener">引用连接</a></p>
<p>[3] 虞大胆的叽叽喳喳,<em>certbot-letencrypt-wildcardcertificates-alydns-au</em> [DB/OL],2018 <a href="https://github.com/ywdblog/certbot-letencrypt-wildcardcertificates-alydns-au" target="_blank" rel="noopener">引用连接</a></p>
</div><div class="tags"><a href="/tags/Let-s-Encrypt/">Let's Encrypt</a><a href="/tags/证书/">证书</a></div><div class="post-nav"><a class="pre" href="/2019/k8s1-13安装.html">k8s1.13安装</a><a class="next" href="/2019/dnf.html">DNF.md</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'true' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'Qq3TXn4kkYB1Y5amjdYD5pQM-gzGzoHsz',
  appKey:'lcphlalpyrDQNucYsK1wLn6D',
  placeholder:'',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://azdj.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/安装/" style="font-size: 15px;">安装</a> <a href="/tags/ITSM/" style="font-size: 15px;">ITSM</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/RPM/" style="font-size: 15px;">RPM</a> <a href="/tags/jenkins/" style="font-size: 15px;">jenkins</a> <a href="/tags/ansible/" style="font-size: 15px;">ansible</a> <a href="/tags/IT服务管理/" style="font-size: 15px;">IT服务管理</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/jumpserver/" style="font-size: 15px;">jumpserver</a> <a href="/tags/跳板机/" style="font-size: 15px;">跳板机</a> <a href="/tags/k8s/" style="font-size: 15px;">k8s</a> <a href="/tags/zabbix/" style="font-size: 15px;">zabbix</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/Let-s-Encrypt/" style="font-size: 15px;">Let's Encrypt</a> <a href="/tags/证书/" style="font-size: 15px;">证书</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/jumpserver简单使用.html">jumpserver简单使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/k8s1-13安装.html">k8s1.13安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/申请免费证书.html">申请免费证书</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/dnf.html">DNF.md</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/基于docker部署zabbix.html">基于docker部署zabbix</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/docker-批量操作.html">docker 批量操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/ansible安装jenkins.html">ansible安装jenkins</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/ITSM.html">ITSM</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/安装java.html">安装java</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/HelloEveryone.html">HelloEveryone</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/welliamcao/OpsManage" title="自动化运维平台" target="_blank">自动化运维平台</a><ul></ul><a href="https://github.com/kurolz/Books" title="运维之道" target="_blank">运维之道</a><ul></ul><a href="https://www.haomwei.com/technology/maupassant-hexo.html" title="大道至简-屠城hexo主题" target="_blank">大道至简-屠城hexo主题</a><ul></ul><a href="https://www.iyunv.com" title="爱运维网" target="_blank">爱运维网</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">AzDj.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>